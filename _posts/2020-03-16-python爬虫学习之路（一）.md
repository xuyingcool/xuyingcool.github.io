---
layout:     post
title:      python爬虫学习之路（一）
subtitle:   第一天
date:       2020-03-16
author:     XY
header-img: img/post-bg-rwd.jpg
catalog: true
tags:   
    - python -爬虫
---

##  python爬虫之路第一天

#### 一、flask-python 简易web

​	使用flask库构造简单服务器网站：

```
import flask
#构造flask app
app = flask.Flask(__name__)

#使用@app.route("/xx")  配置服务路由，method为请求方式
#return返回给客户端的内容
@app.route("/",methods = ["GET","POST"])
def xx():
	return xx
```

#### 二、urllib库简单认识

```
import urllib.request
#5000是flask 默认端口
url = "http://127.0.0.1:5000"

#urlopen()方法对url进行访问，根据里面参数的不同，访问方法也不同
resp=urllib.request.urlopen(url)

#将服务器返回的内容编译为UTF-8的编码。decode默认为utf-8
data=resp.read()
data = data.decode()
```

#### 三、get、post方法访问

**get**方法:

客户端：

````
import urllib.request
url = "http://127.0.0.1:5000" 

#传过去的中文需要经过编码一下，使用urllib.parse.quote方法
c = "深圳"
c = urllib.parse.quote(c)

#拼接后把参数传递过去，使用url?city=....的方法就是get传参
purl = url + "?city=" +c
resp=urllib.request.urlopen(url)
````

服务器端：

```
#接收上面传来的数据，get方法
#可以先判断一下发过来的参数有没有city
#if "city" in flask.request.values
city = flask.request.agrs.get("city")
```

**post**方法:

客户端：

````
import urllib.request
url = "http://127.0.0.1:5000/upload"
c = "深圳"
c = urllib.parse.quote(c)

#把传来的参数经过encode编码成二进制，然后放进data作参数传递过去
#post方法适合传递参数比较多，比较复杂的情况
data ="&city="+c
data_post  =  data.encode()
resp = urllib.request.urlopen(url,data=data_post)
````



服务器端：

```
#用request.form.get接收参数
city= flask.request.form.get("city")

#如果不想区分get 和 post方法的接收，使用values
city = flask.request.values.get("city")
```

#### 四、web下载和上传

**web文件下载**：

服务器端：

```
def download():
#根据第一请求，返回文件名给客户端
    if "fileName" not in flask.request.values:
        s = "图像.jpg"
        return s
 #第二次请求有了文件名，服务器就去读取自己的文件，发送给客户端
    else:
        fileName = flask.request.values.get("fileName")
        f = open(fileName,"rb")
        data = f.read()
        f.close
        return data
```

客户端：

```
#第一请求获取能够下载的文件名
resp = urllib.request.urlopen(url)
data = resp.read()
fileName = data.decode()

#第二次把文件名当成参数发送过去，请求文件的下载
resp = 						   urllib.request.urlopen(url+"fileName="+urllib.parse.quote(fileName))
data = resp.read()
#服务器端返回数据之后，就把数据写入文件
f = open("download//"+fileName,"wb")
f.write(data)
print("下载完成，文件名："+fileName)
```

**web文件上传**：

客户端：

```
#在客户端使用post把文件数据传送过去
#读取文件
fobj = open(fileName,"rb")
data =fobj.read()
fobj.close
#还需要传递一个报文头  octet-stream 表示一个纯粹的流
headers={'content-type':'application/octet-stream'}

purl = url+"?fileName="+urllib.parse.quote(fileName)

#把面的url弄成一个Request对象，里面有url，数据data，报文头headers
req = urllib.request.Request(purl,data,headers)

#之后进行请求
resp = urllib.request.urlopen(req)
```

服务器端：

````
#接收客户端发送过来的文件名参数
fileName = flask.request.values.get("fileName")
#接收客户端发送过来的文件数据 这里使用get_data()方法，接收纯数据流
#对应上面传过来的报文头的接收方法（我的理解）
data = flask.request.get_data()

#把接收到的数据写入到文件
fobj = open("upload"+fileName,"wb")
fobj.write(data)
fobj.close()
````

